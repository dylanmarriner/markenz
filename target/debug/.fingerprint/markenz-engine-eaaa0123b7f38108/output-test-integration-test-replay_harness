{"$message_type":"diagnostic","message":"missing documentation for the crate","code":{"code":"missing_docs","explanation":null},"level":"warning","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":0,"byte_end":13552,"line_start":1,"line_end":377,"column_start":1,"column_end":2,"is_primary":true,"text":[{"text":"/**","highlight_start":1,"highlight_end":4},{"text":" * File: tests/replay_harness.rs","highlight_start":1,"highlight_end":33},{"text":" * ","highlight_start":1,"highlight_end":4},{"text":" * Purpose: Phase 1 replay harness validation","highlight_start":1,"highlight_end":46},{"text":" * ","highlight_start":1,"highlight_end":4},{"text":" * Why this file exists:","highlight_start":1,"highlight_end":25},{"text":" * - Implements comprehensive replay testing for Phase 1 determinism","highlight_start":1,"highlight_end":69},{"text":" * - Validates snapshot creation and loading mechanisms","highlight_start":1,"highlight_end":56},{"text":" * - Tests event log replay with hash verification","highlight_start":1,"highlight_end":51},{"text":" * - Ensures replay equivalence across different scenarios","highlight_start":1,"highlight_end":59},{"text":" * - Validates audit trail preservation during replay","highlight_start":1,"highlight_end":54},{"text":" * ","highlight_start":1,"highlight_end":4},{"text":" * Phase plan authority: docs/plans/PLAN_PHASE_1_DETERMINISM.md","highlight_start":1,"highlight_end":64},{"text":" * Section 6 \"REPLAY HARNESS\", Section 7 \"DETERMINISM GUARANTEES\"","highlight_start":1,"highlight_end":66},{"text":" * ","highlight_start":1,"highlight_end":4},{"text":" * Invariants enforced:","highlight_start":1,"highlight_end":24},{"text":" * - Replay from snapshot produces identical state to live simulation","highlight_start":1,"highlight_end":70},{"text":" * - Event replay order must be strictly preserved","highlight_start":1,"highlight_end":51},{"text":" * - Audit trail must be complete and accurate during replay","highlight_start":1,"highlight_end":61},{"text":" * - Hash verification must catch any replay divergence","highlight_start":1,"highlight_end":56},{"text":" * - Snapshot integrity must be verifiable at load time","highlight_start":1,"highlight_end":56},{"text":" * ","highlight_start":1,"highlight_end":4},{"text":" * What breaks if removed:","highlight_start":1,"highlight_end":27},{"text":" * - No replay testing → Phase 1 replay guarantees unverified","highlight_start":1,"highlight_end":62},{"text":" * - No snapshot validation → snapshot integrity unproven","highlight_start":1,"highlight_end":58},{"text":" * - No audit verification → replay correctness unconfirmed","highlight_start":1,"highlight_end":60},{"text":" * - No hash checking → undetectable replay corruption","highlight_start":1,"highlight_end":55},{"text":" * ","highlight_start":1,"highlight_end":4},{"text":" * What this file does NOT do:","highlight_start":1,"highlight_end":31},{"text":" * - Does not test Phase 2+ features","highlight_start":1,"highlight_end":37},{"text":" * - Does not permit any nondeterministic replay behavior","highlight_start":1,"highlight_end":58},{"text":" * - Does not allow snapshot modification after creation","highlight_start":1,"highlight_end":57},{"text":" */","highlight_start":1,"highlight_end":4},{"text":"","highlight_start":1,"highlight_end":1},{"text":"use std::collections::BTreeMap;","highlight_start":1,"highlight_end":32},{"text":"use markenz_engine::deterministic_world_loop::{DeterministicWorldLoop, DeterministicWorldConfig, DeterministicSnapshot};","highlight_start":1,"highlight_end":121},{"text":"use markenz_events::{InputEvent, InputEventPayload};","highlight_start":1,"highlight_end":53},{"text":"use rng::rng_stream::RngSubsystem;","highlight_start":1,"highlight_end":35},{"text":"","highlight_start":1,"highlight_end":1},{"text":"/// Test snapshot creation and basic integrity","highlight_start":1,"highlight_end":47},{"text":"#[test]","highlight_start":1,"highlight_end":8},{"text":"fn test_snapshot_creation_and_integrity() -> Result<(), String> {","highlight_start":1,"highlight_end":66},{"text":"    let seed = 12345u64;","highlight_start":1,"highlight_end":25},{"text":"    let num_ticks = 50;","highlight_start":1,"highlight_end":24},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    let mut world_loop = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":80},{"text":"        genesis_seed: seed,","highlight_start":1,"highlight_end":28},{"text":"        max_ticks: num_ticks,","highlight_start":1,"highlight_end":30},{"text":"        snapshot_interval: 1000, // No automatic snapshots","highlight_start":1,"highlight_end":59},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Add some events to create interesting state","highlight_start":1,"highlight_end":51},{"text":"    let mut input_events = BTreeMap::new();","highlight_start":1,"highlight_end":44},{"text":"    input_events.insert(10, vec![","highlight_start":1,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 1,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 5.0, y: 10.0, z: 0.0 },","highlight_start":1,"highlight_end":74},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"    ]);","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    input_events.insert(25, vec![","highlight_start":1,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 25,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 2,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: -3.0, y: 7.0, z: 1.0 },","highlight_start":1,"highlight_end":74},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"    ]);","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    world_loop.run(input_events).map_err(|e| format!(\"Initial run failed: {}\", e))?;","highlight_start":1,"highlight_end":85},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Create snapshot at final state","highlight_start":1,"highlight_end":38},{"text":"    let snapshot = DeterministicSnapshot::from_world_loop(&world_loop);","highlight_start":1,"highlight_end":72},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify snapshot integrity","highlight_start":1,"highlight_end":33},{"text":"    snapshot.verify_integrity().map_err(|e| format!(\"Snapshot integrity check failed: {}\", e))?;","highlight_start":1,"highlight_end":97},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify snapshot contents","highlight_start":1,"highlight_end":32},{"text":"    assert_eq!(snapshot.tick, world_loop.current_tick());","highlight_start":1,"highlight_end":58},{"text":"    assert_eq!(snapshot.world_hash, world_loop.current_hash());","highlight_start":1,"highlight_end":64},{"text":"    assert_eq!(snapshot.hash_chain, world_loop.hash_chain());","highlight_start":1,"highlight_end":62},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    println!(\"✅ Snapshot creation and integrity test passed\");","highlight_start":1,"highlight_end":63},{"text":"    Ok(())","highlight_start":1,"highlight_end":11},{"text":"}","highlight_start":1,"highlight_end":2},{"text":"","highlight_start":1,"highlight_end":1},{"text":"/// Test replay from snapshot produces identical results","highlight_start":1,"highlight_end":57},{"text":"#[test]","highlight_start":1,"highlight_end":8},{"text":"fn test_snapshot_replay_identical_results() -> Result<(), String> {","highlight_start":1,"highlight_end":68},{"text":"    let seed = 54321u64;","highlight_start":1,"highlight_end":25},{"text":"    let total_ticks = 100;","highlight_start":1,"highlight_end":27},{"text":"    let snapshot_tick = 50;","highlight_start":1,"highlight_end":28},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Create input events spanning the entire run","highlight_start":1,"highlight_end":51},{"text":"    let mut input_events = BTreeMap::new();","highlight_start":1,"highlight_end":44},{"text":"    for tick in [15, 30, 45, 60, 75, 90] {","highlight_start":1,"highlight_end":43},{"text":"        input_events.insert(tick, vec![","highlight_start":1,"highlight_end":40},{"text":"            InputEvent {","highlight_start":1,"highlight_end":25},{"text":"                tick,","highlight_start":1,"highlight_end":22},{"text":"                source_agent_id: 1,","highlight_start":1,"highlight_end":36},{"text":"                sequence: 1,","highlight_start":1,"highlight_end":29},{"text":"                payload: InputEventPayload::Move { ","highlight_start":1,"highlight_end":52},{"text":"                    x: tick as f32 * 0.5, ","highlight_start":1,"highlight_end":43},{"text":"                    y: tick as f32 * 0.3, ","highlight_start":1,"highlight_end":43},{"text":"                    z: (tick % 5) as f32 ","highlight_start":1,"highlight_end":42},{"text":"                },","highlight_start":1,"highlight_end":19},{"text":"                hash: [0u8; 32],","highlight_start":1,"highlight_end":33},{"text":"                prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":38},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"        ]);","highlight_start":1,"highlight_end":12},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Full run for reference","highlight_start":1,"highlight_end":30},{"text":"    let mut full_loop = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":79},{"text":"        genesis_seed: seed,","highlight_start":1,"highlight_end":28},{"text":"        max_ticks: total_ticks,","highlight_start":1,"highlight_end":32},{"text":"        snapshot_interval: 1000,","highlight_start":1,"highlight_end":33},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    full_loop.run(input_events.clone()).map_err(|e| format!(\"Full run failed: {}\", e))?;","highlight_start":1,"highlight_end":89},{"text":"    let full_final_hash = full_loop.current_hash();","highlight_start":1,"highlight_end":52},{"text":"    let full_hash_chain = full_loop.hash_chain().to_vec();","highlight_start":1,"highlight_end":59},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Create snapshot at tick 50","highlight_start":1,"highlight_end":34},{"text":"    let mut snapshot_loop = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":83},{"text":"        genesis_seed: seed,","highlight_start":1,"highlight_end":28},{"text":"        max_ticks: snapshot_tick,","highlight_start":1,"highlight_end":34},{"text":"        snapshot_interval: 1000,","highlight_start":1,"highlight_end":33},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    let snapshot_events: BTreeMap<u64, Vec<InputEvent>> = input_events","highlight_start":1,"highlight_end":71},{"text":"        .iter()","highlight_start":1,"highlight_end":16},{"text":"        .filter(|(&tick, _)| tick <= snapshot_tick)","highlight_start":1,"highlight_end":52},{"text":"        .map(|(&tick, events)| (tick, events.clone()))","highlight_start":1,"highlight_end":55},{"text":"        .collect();","highlight_start":1,"highlight_end":20},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    snapshot_loop.run(snapshot_events).map_err(|e| format!(\"Snapshot run failed: {}\", e))?;","highlight_start":1,"highlight_end":92},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    let snapshot = DeterministicSnapshot::from_world_loop(&snapshot_loop);","highlight_start":1,"highlight_end":75},{"text":"    snapshot.verify_integrity().map_err(|e| format!(\"Snapshot verification failed: {}\", e))?;","highlight_start":1,"highlight_end":94},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Continue from snapshot to total_ticks","highlight_start":1,"highlight_end":45},{"text":"    let mut replay_loop = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":81},{"text":"        genesis_seed: seed, // Same seed (required for deterministic replay)","highlight_start":1,"highlight_end":77},{"text":"        max_ticks: total_ticks,","highlight_start":1,"highlight_end":32},{"text":"        snapshot_interval: 1000,","highlight_start":1,"highlight_end":33},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Load snapshot state (in real implementation, this would deserialize)","highlight_start":1,"highlight_end":76},{"text":"    replay_loop.universe = snapshot.universe.clone();","highlight_start":1,"highlight_end":54},{"text":"    replay_loop.rng = snapshot.rng_state.clone();","highlight_start":1,"highlight_end":50},{"text":"    replay_loop.current_tick = snapshot.tick;","highlight_start":1,"highlight_end":46},{"text":"    replay_loop.hash_chain = snapshot.hash_chain.clone();","highlight_start":1,"highlight_end":58},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Process remaining events","highlight_start":1,"highlight_end":32},{"text":"    let remaining_events: BTreeMap<u64, Vec<InputEvent>> = input_events","highlight_start":1,"highlight_end":72},{"text":"        .iter()","highlight_start":1,"highlight_end":16},{"text":"        .filter(|(&tick, _)| tick > snapshot_tick)","highlight_start":1,"highlight_end":51},{"text":"        .map(|(&tick, events)| (tick, events.clone()))","highlight_start":1,"highlight_end":55},{"text":"        .collect();","highlight_start":1,"highlight_end":20},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    replay_loop.run(remaining_events).map_err(|e| format!(\"Replay continuation failed: {}\", e))?;","highlight_start":1,"highlight_end":98},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    let replay_final_hash = replay_loop.current_hash();","highlight_start":1,"highlight_end":56},{"text":"    let replay_hash_chain = replay_loop.hash_chain().to_vec();","highlight_start":1,"highlight_end":63},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify final results are identical","highlight_start":1,"highlight_end":42},{"text":"    assert_eq!(full_final_hash, replay_final_hash, ","highlight_start":1,"highlight_end":52},{"text":"        \"Final hashes differ: full={:x?}, replay={:x?}\", ","highlight_start":1,"highlight_end":58},{"text":"        full_final_hash, replay_final_hash);","highlight_start":1,"highlight_end":45},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify hash chains from snapshot point onward are identical","highlight_start":1,"highlight_end":67},{"text":"    let full_tail = &full_hash_chain[snapshot_tick as usize..];","highlight_start":1,"highlight_end":64},{"text":"    let replay_tail = &replay_hash_chain[snapshot_tick as usize..];","highlight_start":1,"highlight_end":68},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    assert_eq!(full_tail.len(), replay_tail.len(), \"Hash chain tail length mismatch\");","highlight_start":1,"highlight_end":87},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    for (i, (full_hash, replay_hash)) in full_tail.iter().zip(replay_tail.iter()).enumerate() {","highlight_start":1,"highlight_end":96},{"text":"        let tick = snapshot_tick + i as u64;","highlight_start":1,"highlight_end":45},{"text":"        assert_eq!(full_hash, replay_hash, ","highlight_start":1,"highlight_end":44},{"text":"            \"Hash mismatch at tick {}: full={:x?}, replay={:x?}\", ","highlight_start":1,"highlight_end":67},{"text":"            tick, full_hash, replay_hash);","highlight_start":1,"highlight_end":43},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    println!(\"✅ Snapshot replay identical results test passed\");","highlight_start":1,"highlight_end":65},{"text":"    Ok(())","highlight_start":1,"highlight_end":11},{"text":"}","highlight_start":1,"highlight_end":2},{"text":"","highlight_start":1,"highlight_end":1},{"text":"/// Test event order preservation during replay","highlight_start":1,"highlight_end":48},{"text":"#[test]","highlight_start":1,"highlight_end":8},{"text":"fn test_event_order_preservation() -> Result<(), String> {","highlight_start":1,"highlight_end":59},{"text":"    let seed = 98765u64;","highlight_start":1,"highlight_end":25},{"text":"    let num_ticks = 30;","highlight_start":1,"highlight_end":24},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Create events with specific ordering requirements","highlight_start":1,"highlight_end":57},{"text":"    let mut input_events = BTreeMap::new();","highlight_start":1,"highlight_end":44},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Multiple events in same tick (must be processed in sequence order)","highlight_start":1,"highlight_end":74},{"text":"    input_events.insert(10, vec![","highlight_start":1,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 1,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 1.0, y: 0.0, z: 0.0 },","highlight_start":1,"highlight_end":73},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        },","highlight_start":1,"highlight_end":11},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 2,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 2,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 0.0, y: 1.0, z: 0.0 },","highlight_start":1,"highlight_end":73},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        },","highlight_start":1,"highlight_end":11},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 3,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 3,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 0.0, y: 0.0, z: 1.0 },","highlight_start":1,"highlight_end":73},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        },","highlight_start":1,"highlight_end":11},{"text":"    ]);","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Events across different ticks","highlight_start":1,"highlight_end":37},{"text":"    input_events.insert(20, vec![","highlight_start":1,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 20,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 1,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: -1.0, y: 0.0, z: 0.0 },","highlight_start":1,"highlight_end":74},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"    ]);","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Run twice to verify order preservation","highlight_start":1,"highlight_end":46},{"text":"    let mut loop1 = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":75},{"text":"        genesis_seed: seed,","highlight_start":1,"highlight_end":28},{"text":"        max_ticks: num_ticks,","highlight_start":1,"highlight_end":30},{"text":"        snapshot_interval: 1000,","highlight_start":1,"highlight_end":33},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    let mut loop2 = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":75},{"text":"        genesis_seed: seed,","highlight_start":1,"highlight_end":28},{"text":"        max_ticks: num_ticks,","highlight_start":1,"highlight_end":30},{"text":"        snapshot_interval: 1000,","highlight_start":1,"highlight_end":33},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    loop1.run(input_events.clone()).map_err(|e| format!(\"First run failed: {}\", e))?;","highlight_start":1,"highlight_end":86},{"text":"    loop2.run(input_events).map_err(|e| format!(\"Second run failed: {}\", e))?;","highlight_start":1,"highlight_end":79},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify identical hash sequences","highlight_start":1,"highlight_end":39},{"text":"    let hashes1 = loop1.hash_chain();","highlight_start":1,"highlight_end":38},{"text":"    let hashes2 = loop2.hash_chain();","highlight_start":1,"highlight_end":38},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    assert_eq!(hashes1.len(), hashes2.len(), \"Hash chain length mismatch\");","highlight_start":1,"highlight_end":76},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    for (i, (h1, h2)) in hashes1.iter().zip(hashes2.iter()).enumerate() {","highlight_start":1,"highlight_end":74},{"text":"        assert_eq!(h1, h2, \"Hash mismatch at tick {}: {:x?} vs {:x?}\", i, h1, h2);","highlight_start":1,"highlight_end":83},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify RNG audit logs are identical","highlight_start":1,"highlight_end":43},{"text":"    let audit1 = loop1.rng_audit_log();","highlight_start":1,"highlight_end":40},{"text":"    let audit2 = loop2.rng_audit_log();","highlight_start":1,"highlight_end":40},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    assert_eq!(audit1.len(), audit2.len(), \"Audit log length mismatch\");","highlight_start":1,"highlight_end":73},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    for (i, (record1, record2)) in audit1.records().iter().zip(audit2.records().iter()).enumerate() {","highlight_start":1,"highlight_end":102},{"text":"        assert_eq!(record1.tick, record2.tick, \"Audit record {} tick mismatch\", i);","highlight_start":1,"highlight_end":84},{"text":"        assert_eq!(record1.subsystem, record2.subsystem, \"Audit record {} subsystem mismatch\", i);","highlight_start":1,"highlight_end":99},{"text":"        assert_eq!(record1.value, record2.value, \"Audit record {} value mismatch\", i);","highlight_start":1,"highlight_end":87},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    println!(\"✅ Event order preservation test passed\");","highlight_start":1,"highlight_end":56},{"text":"    Ok(())","highlight_start":1,"highlight_end":11},{"text":"}","highlight_start":1,"highlight_end":2},{"text":"","highlight_start":1,"highlight_end":1},{"text":"/// Test audit trail preservation during replay","highlight_start":1,"highlight_end":48},{"text":"#[test]","highlight_start":1,"highlight_end":8},{"text":"fn test_audit_trail_preservation() -> Result<(), String> {","highlight_start":1,"highlight_end":59},{"text":"    let seed = 11111u64;","highlight_start":1,"highlight_end":25},{"text":"    let num_ticks = 25;","highlight_start":1,"highlight_end":24},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    let mut world_loop = DeterministicWorldLoop::new(DeterministicWorldConfig {","highlight_start":1,"highlight_end":80},{"text":"        genesis_seed: seed,","highlight_start":1,"highlight_end":28},{"text":"        max_ticks: num_ticks,","highlight_start":1,"highlight_end":30},{"text":"        snapshot_interval: 1000,","highlight_start":1,"highlight_end":33},{"text":"        tick_rate_ms: 50,","highlight_start":1,"highlight_end":26},{"text":"    });","highlight_start":1,"highlight_end":8},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Create events that trigger RNG usage","highlight_start":1,"highlight_end":44},{"text":"    let mut input_events = BTreeMap::new();","highlight_start":1,"highlight_end":44},{"text":"    for tick in [5, 10, 15, 20] {","highlight_start":1,"highlight_end":34},{"text":"        input_events.insert(tick, vec![","highlight_start":1,"highlight_end":40},{"text":"            InputEvent {","highlight_start":1,"highlight_end":25},{"text":"                tick,","highlight_start":1,"highlight_end":22},{"text":"                source_agent_id: 1,","highlight_start":1,"highlight_end":36},{"text":"                sequence: 1,","highlight_start":1,"highlight_end":29},{"text":"                payload: InputEventPayload::Move { x: tick as f32, y: 0.0, z: 0.0 },","highlight_start":1,"highlight_end":85},{"text":"                hash: [0u8; 32],","highlight_start":1,"highlight_end":33},{"text":"                prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":38},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"        ]);","highlight_start":1,"highlight_end":12},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    world_loop.run(input_events).map_err(|e| format!(\"Run failed: {}\", e))?;","highlight_start":1,"highlight_end":77},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify audit log completeness","highlight_start":1,"highlight_end":37},{"text":"    let audit_log = world_loop.rng_audit_log();","highlight_start":1,"highlight_end":48},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Should have RNG entries for each movement event","highlight_start":1,"highlight_end":55},{"text":"    assert!(!audit_log.is_empty(), \"Audit log should not be empty\");","highlight_start":1,"highlight_end":69},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify all entries have required fields","highlight_start":1,"highlight_end":47},{"text":"    for (i, record) in audit_log.records().iter().enumerate() {","highlight_start":1,"highlight_end":64},{"text":"        assert!(record.tick > 0, \"Record {} has invalid tick\", i);","highlight_start":1,"highlight_end":67},{"text":"        assert!(record.value > 0, \"Record {} has invalid value\", i);","highlight_start":1,"highlight_end":69},{"text":"        assert!(!record.callsite.is_empty(), \"Record {} has empty callsite\", i);","highlight_start":1,"highlight_end":81},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify subsystem distribution","highlight_start":1,"highlight_end":37},{"text":"    let physics_records = audit_log.records_by_subsystem(RngSubsystem::Physics);","highlight_start":1,"highlight_end":81},{"text":"    assert!(!physics_records.is_empty(), \"Should have physics RNG records\");","highlight_start":1,"highlight_end":77},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify tick ordering in audit log","highlight_start":1,"highlight_end":41},{"text":"    let mut prev_tick = 0u64;","highlight_start":1,"highlight_end":30},{"text":"    for record in audit_log.records() {","highlight_start":1,"highlight_end":40},{"text":"        assert!(record.tick >= prev_tick, \"Audit log not ordered by tick\");","highlight_start":1,"highlight_end":76},{"text":"        prev_tick = record.tick;","highlight_start":1,"highlight_end":33},{"text":"    }","highlight_start":1,"highlight_end":6},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Create snapshot and verify audit preservation","highlight_start":1,"highlight_end":53},{"text":"    let snapshot = DeterministicSnapshot::from_world_loop(&world_loop);","highlight_start":1,"highlight_end":72},{"text":"    snapshot.verify_integrity().map_err(|e| format!(\"Snapshot verification failed: {}\", e))?;","highlight_start":1,"highlight_end":94},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Verify audit log is preserved in snapshot","highlight_start":1,"highlight_end":49},{"text":"    let snapshot_audit = snapshot.rng_state.audit_log();","highlight_start":1,"highlight_end":57},{"text":"    assert_eq!(audit_log.len(), snapshot_audit.len(), \"Audit log length not preserved in snapshot\");","highlight_start":1,"highlight_end":101},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    println!(\"✅ Audit trail preservation test passed\");","highlight_start":1,"highlight_end":56},{"text":"    Ok(())","highlight_start":1,"highlight_end":11},{"text":"}","highlight_start":1,"highlight_end":2},{"text":"","highlight_start":1,"highlight_end":1},{"text":"/// Test comprehensive replay scenario","highlight_start":1,"highlight_end":39},{"text":"#[test]","highlight_start":1,"highlight_end":8},{"text":"fn test_comprehensive_replay_scenario() -> Result<(), String> {","highlight_start":1,"highlight_end":64},{"text":"    println!(\"Running comprehensive replay scenario test...\");","highlight_start":1,"highlight_end":63},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    // Test all replay functionality","highlight_start":1,"highlight_end":37},{"text":"    test_snapshot_creation_and_integrity()?;","highlight_start":1,"highlight_end":45},{"text":"    test_snapshot_replay_identical_results()?;","highlight_start":1,"highlight_end":47},{"text":"    test_event_order_preservation()?;","highlight_start":1,"highlight_end":38},{"text":"    test_audit_trail_preservation()?;","highlight_start":1,"highlight_end":38},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    println!(\"✅ COMPREHENSIVE REPLAY SCENARIO TEST PASSED\");","highlight_start":1,"highlight_end":61},{"text":"    println!(\"All replay harness functionality verified:\");","highlight_start":1,"highlight_end":60},{"text":"    println!(\"  - Snapshot creation and integrity ✓\");","highlight_start":1,"highlight_end":55},{"text":"    println!(\"  - Snapshot replay equivalence ✓\");","highlight_start":1,"highlight_end":51},{"text":"    println!(\"  - Event order preservation ✓\");","highlight_start":1,"highlight_end":48},{"text":"    println!(\"  - Audit trail preservation ✓\");","highlight_start":1,"highlight_end":48},{"text":"    ","highlight_start":1,"highlight_end":5},{"text":"    Ok(())","highlight_start":1,"highlight_end":11},{"text":"}","highlight_start":1,"highlight_end":2}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[{"message":"requested on the command line with `-W missing-docs`","code":null,"level":"note","spans":[],"children":[],"rendered":null}],"rendered":"\u001b[1m\u001b[33mwarning\u001b[0m\u001b[1m: missing documentation for the crate\u001b[0m\n   \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:1:1\n    \u001b[1m\u001b[94m|\u001b[0m\n  \u001b[1m\u001b[94m1\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m/\u001b[0m /**\n  \u001b[1m\u001b[94m2\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m|\u001b[0m  * File: tests/replay_harness.rs\n  \u001b[1m\u001b[94m3\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m|\u001b[0m  * \n  \u001b[1m\u001b[94m4\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m|\u001b[0m  * Purpose: Phase 1 replay harness validation\n\u001b[1m\u001b[94m...\u001b[0m   \u001b[1m\u001b[33m|\u001b[0m\n\u001b[1m\u001b[94m376\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m|\u001b[0m     Ok(())\n\u001b[1m\u001b[94m377\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m|\u001b[0m }\n    \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[33m|_^\u001b[0m\n    \u001b[1m\u001b[94m|\u001b[0m\n    \u001b[1m\u001b[94m= \u001b[0m\u001b[1mnote\u001b[0m: requested on the command line with `-W missing-docs`\n\n"}
{"$message_type":"diagnostic","message":"unused result of type `Option<Vec<InputEvent>>`","code":{"code":"unused_results","explanation":null},"level":"error","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":2079,"byte_end":2363,"line_start":55,"line_end":64,"column_start":5,"column_end":8,"is_primary":true,"text":[{"text":"    input_events.insert(10, vec![","highlight_start":5,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 1,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 5.0, y: 10.0, z: 0.0 },","highlight_start":1,"highlight_end":74},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"    ]);","highlight_start":1,"highlight_end":8}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[{"message":"requested on the command line with `-D unused-results`","code":null,"level":"note","spans":[],"children":[],"rendered":null}],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: unused result of type `Option<Vec<InputEvent>>`\u001b[0m\n  \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:55:5\n   \u001b[1m\u001b[94m|\u001b[0m\n\u001b[1m\u001b[94m55\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m/\u001b[0m     input_events.insert(10, vec![\n\u001b[1m\u001b[94m56\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         InputEvent {\n\u001b[1m\u001b[94m57\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             tick: 10,\n\u001b[1m\u001b[94m58\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             source_agent_id: 1,\n\u001b[1m\u001b[94m...\u001b[0m  \u001b[1m\u001b[91m|\u001b[0m\n\u001b[1m\u001b[94m64\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m     ]);\n   \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|_______^\u001b[0m\n   \u001b[1m\u001b[94m|\u001b[0m\n   \u001b[1m\u001b[94m= \u001b[0m\u001b[1mnote\u001b[0m: requested on the command line with `-D unused-results`\n\n"}
{"$message_type":"diagnostic","message":"unused result of type `Option<Vec<InputEvent>>`","code":{"code":"unused_results","explanation":null},"level":"error","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":2373,"byte_end":2657,"line_start":66,"line_end":75,"column_start":5,"column_end":8,"is_primary":true,"text":[{"text":"    input_events.insert(25, vec![","highlight_start":5,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 25,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 2,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: -3.0, y: 7.0, z: 1.0 },","highlight_start":1,"highlight_end":74},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"    ]);","highlight_start":1,"highlight_end":8}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: unused result of type `Option<Vec<InputEvent>>`\u001b[0m\n  \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:66:5\n   \u001b[1m\u001b[94m|\u001b[0m\n\u001b[1m\u001b[94m66\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m/\u001b[0m     input_events.insert(25, vec![\n\u001b[1m\u001b[94m67\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         InputEvent {\n\u001b[1m\u001b[94m68\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             tick: 25,\n\u001b[1m\u001b[94m69\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             source_agent_id: 2,\n\u001b[1m\u001b[94m...\u001b[0m  \u001b[1m\u001b[91m|\u001b[0m\n\u001b[1m\u001b[94m75\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m     ]);\n   \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|_______^\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"unused result of type `Option<Vec<InputEvent>>`","code":{"code":"unused_results","explanation":null},"level":"error","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":3667,"byte_end":4106,"line_start":104,"line_end":117,"column_start":9,"column_end":12,"is_primary":true,"text":[{"text":"        input_events.insert(tick, vec![","highlight_start":9,"highlight_end":40},{"text":"            InputEvent {","highlight_start":1,"highlight_end":25},{"text":"                tick,","highlight_start":1,"highlight_end":22},{"text":"                source_agent_id: 1,","highlight_start":1,"highlight_end":36},{"text":"                sequence: 1,","highlight_start":1,"highlight_end":29},{"text":"                payload: InputEventPayload::Move { ","highlight_start":1,"highlight_end":52},{"text":"                    x: tick as f32 * 0.5, ","highlight_start":1,"highlight_end":43},{"text":"                    y: tick as f32 * 0.3, ","highlight_start":1,"highlight_end":43},{"text":"                    z: (tick % 5) as f32 ","highlight_start":1,"highlight_end":42},{"text":"                },","highlight_start":1,"highlight_end":19},{"text":"                hash: [0u8; 32],","highlight_start":1,"highlight_end":33},{"text":"                prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":38},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"        ]);","highlight_start":1,"highlight_end":12}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: unused result of type `Option<Vec<InputEvent>>`\u001b[0m\n   \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:104:9\n    \u001b[1m\u001b[94m|\u001b[0m\n\u001b[1m\u001b[94m104\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m/\u001b[0m         input_events.insert(tick, vec![\n\u001b[1m\u001b[94m105\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             InputEvent {\n\u001b[1m\u001b[94m106\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m                 tick,\n\u001b[1m\u001b[94m107\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m                 source_agent_id: 1,\n\u001b[1m\u001b[94m...\u001b[0m   \u001b[1m\u001b[91m|\u001b[0m\n\u001b[1m\u001b[94m117\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         ]);\n    \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|___________^\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"unused result of type `Option<Vec<InputEvent>>`","code":{"code":"unused_results","explanation":null},"level":"error","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":7617,"byte_end":8395,"line_start":209,"line_end":234,"column_start":5,"column_end":8,"is_primary":true,"text":[{"text":"    input_events.insert(10, vec![","highlight_start":5,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 1,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 1.0, y: 0.0, z: 0.0 },","highlight_start":1,"highlight_end":73},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        },","highlight_start":1,"highlight_end":11},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 2,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 2,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 0.0, y: 1.0, z: 0.0 },","highlight_start":1,"highlight_end":73},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        },","highlight_start":1,"highlight_end":11},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 10,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 3,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 3,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: 0.0, y: 0.0, z: 1.0 },","highlight_start":1,"highlight_end":73},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        },","highlight_start":1,"highlight_end":11},{"text":"    ]);","highlight_start":1,"highlight_end":8}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: unused result of type `Option<Vec<InputEvent>>`\u001b[0m\n   \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:209:5\n    \u001b[1m\u001b[94m|\u001b[0m\n\u001b[1m\u001b[94m209\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m/\u001b[0m     input_events.insert(10, vec![\n\u001b[1m\u001b[94m210\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         InputEvent {\n\u001b[1m\u001b[94m211\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             tick: 10,\n\u001b[1m\u001b[94m212\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             source_agent_id: 1,\n\u001b[1m\u001b[94m...\u001b[0m   \u001b[1m\u001b[91m|\u001b[0m\n\u001b[1m\u001b[94m233\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         },\n\u001b[1m\u001b[94m234\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m     ]);\n    \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|_______^\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"unused result of type `Option<Vec<InputEvent>>`","code":{"code":"unused_results","explanation":null},"level":"error","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":8442,"byte_end":8726,"line_start":237,"line_end":246,"column_start":5,"column_end":8,"is_primary":true,"text":[{"text":"    input_events.insert(20, vec![","highlight_start":5,"highlight_end":34},{"text":"        InputEvent {","highlight_start":1,"highlight_end":21},{"text":"            tick: 20,","highlight_start":1,"highlight_end":22},{"text":"            source_agent_id: 1,","highlight_start":1,"highlight_end":32},{"text":"            sequence: 1,","highlight_start":1,"highlight_end":25},{"text":"            payload: InputEventPayload::Move { x: -1.0, y: 0.0, z: 0.0 },","highlight_start":1,"highlight_end":74},{"text":"            hash: [0u8; 32],","highlight_start":1,"highlight_end":29},{"text":"            prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":34},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"    ]);","highlight_start":1,"highlight_end":8}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: unused result of type `Option<Vec<InputEvent>>`\u001b[0m\n   \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:237:5\n    \u001b[1m\u001b[94m|\u001b[0m\n\u001b[1m\u001b[94m237\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m/\u001b[0m     input_events.insert(20, vec![\n\u001b[1m\u001b[94m238\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         InputEvent {\n\u001b[1m\u001b[94m239\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             tick: 20,\n\u001b[1m\u001b[94m240\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             source_agent_id: 1,\n\u001b[1m\u001b[94m...\u001b[0m   \u001b[1m\u001b[91m|\u001b[0m\n\u001b[1m\u001b[94m246\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m     ]);\n    \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|_______^\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"unused result of type `Option<Vec<InputEvent>>`","code":{"code":"unused_results","explanation":null},"level":"error","spans":[{"file_name":"apps/engine/../../tests/replay_harness.rs","byte_start":10897,"byte_end":11222,"line_start":308,"line_end":317,"column_start":9,"column_end":12,"is_primary":true,"text":[{"text":"        input_events.insert(tick, vec![","highlight_start":9,"highlight_end":40},{"text":"            InputEvent {","highlight_start":1,"highlight_end":25},{"text":"                tick,","highlight_start":1,"highlight_end":22},{"text":"                source_agent_id: 1,","highlight_start":1,"highlight_end":36},{"text":"                sequence: 1,","highlight_start":1,"highlight_end":29},{"text":"                payload: InputEventPayload::Move { x: tick as f32, y: 0.0, z: 0.0 },","highlight_start":1,"highlight_end":85},{"text":"                hash: [0u8; 32],","highlight_start":1,"highlight_end":33},{"text":"                prev_hash: [0u8; 32],","highlight_start":1,"highlight_end":38},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"        ]);","highlight_start":1,"highlight_end":12}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: unused result of type `Option<Vec<InputEvent>>`\u001b[0m\n   \u001b[1m\u001b[94m--> \u001b[0mapps/engine/../../tests/replay_harness.rs:308:9\n    \u001b[1m\u001b[94m|\u001b[0m\n\u001b[1m\u001b[94m308\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m/\u001b[0m         input_events.insert(tick, vec![\n\u001b[1m\u001b[94m309\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m             InputEvent {\n\u001b[1m\u001b[94m310\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m                 tick,\n\u001b[1m\u001b[94m311\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m                 source_agent_id: 1,\n\u001b[1m\u001b[94m...\u001b[0m   \u001b[1m\u001b[91m|\u001b[0m\n\u001b[1m\u001b[94m317\u001b[0m \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|\u001b[0m         ]);\n    \u001b[1m\u001b[94m|\u001b[0m \u001b[1m\u001b[91m|___________^\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"aborting due to 6 previous errors; 1 warning emitted","code":null,"level":"error","spans":[],"children":[],"rendered":"\u001b[1m\u001b[91merror\u001b[0m\u001b[1m: aborting due to 6 previous errors; 1 warning emitted\u001b[0m\n\n"}
